---
title: "Lab 1 Cancer EDA"
author: "Daniel Rasband, Subha Vadakkumkoor, Hong Yang"
date: \today
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(car)
```

## Problem Set

We were hired by a health government agency to understand and predict cancer mortality rates:

1. Understand factors that predict cancer mortality rates
2. Identity communities for social interventions
3. Understand which interventions are likely to have the impact

### Objective of this Lab

Perform an exploratory analysis to understand how county-level characteristics are related to cancer mortality.

## Data Set

```{r load}
canc.dat <- read.csv('cancer.csv', header = TRUE)
```

### Summary

```{r}
summary(canc.dat)
```

### Variables

```{r}
names(canc.dat)
```

#### Meanings

The X column appears to be a simple auto-incremented ID, so it is ignored. We are assuming that the rest of the columns have the following meanings. If these assumptions prove to be incorrect, the analysis may also be incorrect.

* `avgAnnCount`: Average cancer total incidences per year from 2009-2013.
* `medIncome`: Median Income
* `popEst2015`: Estimated population in 2015
* `povertyPercent`: Percentage of population below poverty level
* `binnedInc`: Income range
* `MedianAge`: Median Age
* `MedianAgeMale`: Median Age of Males
* `MedianAgeFemale`: Median Age of Females
* `Geography`: County, State
* `AvgHouseholdSize`: Average Household Size
* `PercentMarried`: Percent of population that is married
* `PctNoHS18_24`: Percent of population, ages 18-24, that hasn't graduated from high school.
* `PctHS18_24`: Percent of population, ages 18-24, that has graduated from high school.
* `PctSomeCol18_24`: Percentage of 18-24-year-olds that have some college education.
* `PctBachDeg18_24`: Percentage of 18-24-year-olds that have a bachelor's degree.
* `PctHS25_Over`: Percentage of population, 25 and older, graduated from high school.
* `PctBachDeg25_Over`: Percentage of population, 25 and older, graduated from college.
* `PctEmployed16_Over`: Percentage of population, 16 and older, that is employed.
* `PctUnemployed16_Over`: Percentage of population, 16 and older, that is unemployed.
* `PctPrivateCoverage`: Percentage of population with private insurance coverage.
* `PctEmpPrivCoverage`: Percentage of population with private insurance coverage from employment.
* `PctPublicCoverage`: Percentage of population with public insurance coverage.
* `PctWhite`: Percentage of population that is white.
* `PctBlack`: Percentage of population that is black.
* `PctAsian`: Percentage of population that is asian.
* `PctOtherRace`: Percentage of population that is not white, black, or asian.
* `PctMarriedHouseholds`: Percentage of the population that is in a married household.
* `BirthRate`: The birth rate, unknown basis.
* `deathRate`: The death rate, per 100,000 people.

The most questionable of the above assumptions is that of the `deathRate`, but comparing the numbers with those in [a PDF of death-related statistics for Los Angeles county](http://publichealth.lacounty.gov/dca/data/documents/mortalitypresentation2012.pdf), and by using a bit of common sense, it appears that the rate is per 100,000 people. The birth rate is similarly questionable, but by using Los Angeles's data, it appears that the number is per 100 women, 15-44. This could be a bit of a problem since we don't know the population of women in that age range, except that we will not be using that data point in this exploratory analysis, so we will ignore it.

Another fundamentally questionable aspect of the data is that most data points do not have a reference year. We are assuming 2015 for those data, but that may not be accurate.

### Number of Observations

There are 3047 observations in the data set.

```{r}
nrow(canc.dat)
```

The number of counties equals the number of observations, so no county has multiple rows of data.

```{r}
length(unique(canc.dat$Geography)) == nrow(canc.dat)
```

## Data Cleaning

While perusing the data, we have found that there are some pieces that need to be cleaned up. First of all, the `avgAnnCount` has 206 rows that are 1) the exact same number, and 2) greater than the actual population. This indicates to us that those values were missing from the data and had been assigned a default value (`1962.668`). Because the `avgAnnCount` is crucial to this analysis, and those values have proven nonsensical, we will have to remove them:

```{r}
canc.dat[canc.dat$avgAnnCount > canc.dat$popEst2015, c('X', 'avgAnnCount')]
```

```{r}
fixed.dat <- subset(canc.dat, avgAnnCount != canc.dat$avgAnnCount[116])
nrow(fixed.dat)
```

The `PctSomeCol18_24` variable has a large majority of missing values, so we are opting to remove the column entirely for the dataset. This has potential to make it more difficult to find correlation between cancer death rates and educational status, but the data is too sparse to use.

```{r}
fixed.dat = subset(fixed.dat, select = -c(PctSomeCol18_24))
names(fixed.dat)
```

Lastly, it appears that `MedianAge` is set to months, rather than years, in a number of cases, so we adjust those rows:

```{r}
age.outliers = fixed.dat$MedianAge > 100
fixed.dat$MedianAge[age.outliers] = fixed.dat$MedianAge[age.outliers] / 12
# Sanity check
summary(fixed.dat$MedianAge, fixed.dat$MedianAgeFemale, fixed.dat$MedianAgeMale)
```

## Extra Variables

Our task is to look for correlations between cancer death rate and other factors, but cancer death rate is not given. This is the biggest issue with the data and our assumption here greatly reduces the effectiveness of the exploratory data analysis. Our effort here will be to compute the rate of cancer incidents to deaths, and use that as a measure of approximately how frequent cancer causes death.

```{r}
# The percentage of the population that had cancer. This may be flawed, because some people may have been diagnosed twice or more.
fixed.dat$cancerRate = fixed.dat$avgAnnCount / fixed.dat$popEst2015
summary(fixed.dat$cancerRate)
```

Cancer incidents are very strongly correlated with populations, which means that the more people, the more cancer incidents.

```{r}
cor(fixed.dat$avgAnnCount, fixed.dat$popEst2015)
```

```{r}
# The percentage of each population that died.
fixed.dat$realDeathRate = fixed.dat$deathRate / 100000
summary(fixed.dat$realDeathRate)
```

```{r}
# The ratio of deaths (of any kind) to cancer incidents
fixed.dat$deathToCancerRate = fixed.dat$realDeathRate / fixed.dat$cancerRate
summary(fixed.dat$deathToCancerRate)
```

This measurement indicates a lower number of deaths per cancer incident when the ratio is low relative to other counties. Again, this isn't a direct measurement of cancer mortality, but it may give us a general idea.

## Exploration

### Coorelation between cancerRate and realDeathRate

Since there is not a clear defined cancer death rate, we used cancerRate to compare with realDeathRate to establish the coorelation "when cancerRate is increasing, realDeathRate is increasing".  Again, this is base on the data we have been given, we are aware of that not every cancer incident results in death.

```{r}
scatterplotMatrix(~ fixed.dat$cancerRate + fixed.dat$realDeathRate, data = fixed.dat)
```

### Income / Poverty & Insurance Coverage

When cancerRate is high, PctPublicCoverage is high and medIncome is relativly low, we will further examine them.  We also noticed that public coverage and private coverage seem mutually exclusive.

```{r}
cor(fixed.dat[ , c("cancerRate","PctPrivateCoverage","PctPublicCoverage","povertyPercent", "medIncome")], use = "complete.obs")
```

This initial examination shows there are indication that PctPublicCoverage and medIncome have impact on cancerRate, especailly few outliers.  Other variables don't have much strong impact from these plots.  We will examine further.

```{r}
hist(fixed.dat$cancerRate, main = "Cancer Rate", xlab = NULL)
boxplot(fixed.dat$cancerRate ~ fixed.dat$PctPublicCoverage, main = "Public Insurance Coverage vs Cancer Rate", xlab = "% Public Coverage", ylab = "Cancer Rate")
boxplot(fixed.dat$cancerRate ~ fixed.dat$medIncome, main = "Median Income vs Cancer Rate", xlab = "Median Income", ylab = "Cancer Rate")

plot(fixed.dat$PctPublicCoverage, main = "Public Insurance Coverage")
plot(fixed.dat$PctPrivateCoverage, main = "Private Insurance Coverage")

hist(fixed.dat$povertyPercent, breaks = 10, xlab = NULL, main = "Poverty Percentage")
```

Based on the fact that we are examine the variables which are impacting high cancer rate, we will take a closer look at the data for avgAnnCount greater than 250. 250 cancer incidents per county anually is still relatively high, we pick this number because it's between median and mean and closer to median. The mean is much higher than the median indicates the one plus few more extreamly high cancer incident numbers, by selecting the data above the mean will miss the chance with most representative data.

```{r}
summary(fixed.dat$avgAnnCount)

highInc.dat = fixed.dat[fixed.dat$avgAnnCount > 250,c("avgAnnCount", "cancerRate", "Geography", "medIncome", "PctPublicCoverage", "PctPrivateCoverage", "povertyPercent", "AvgHouseholdSize", "cancerToDeathRate")]
highInc.dat

nrow(highInc.dat)
```

Lower medIncome and higher PctPublicCoverage have the most impact on cancerRate.  Public incurance often have limited coverage for cancer treatment.  Private coverage doesn't seem to have strong impact on cancerRate as well as povertyPercent.

```{r}
plot(highInc.dat$cancerRate ~ highInc.dat$medIncome, main = "Median Income to Cancer Rate", xlab = "Median Income", ylab = "Cancer Rate", las = 1, xlim = c(120000, 30000), col = 4)
abline(lm(highInc.dat$cancerRate ~ highInc.dat$medIncome), col = 2)

plot(highInc.dat$cancerRate ~ highInc.dat$PctPublicCoverage, main = "Public Insurance Coverage vs Cancer Rate", xlab = "Public Coverage %", ylab = "Cancer Rate", col = 4)
abline(lm(highInc.dat$cancerRate ~ highInc.dat$PctPublicCoverage), col = 2)

plot(highInc.dat$cancerRate ~ highInc.dat$PctPrivateCoverage, main = "Private Insurance Coverage vs Cancer Rate", xlab = "Private Coverage %", ylab = "Cancer Rate", col = 4)
abline(lm(highInc.dat$cancerRate ~ highInc.dat$PctPrivateCoverage), col = 2)

plot(highInc.dat$cancerRate ~ highInc.dat$povertyPercent, main = "Poverty to Cancer Rate", xlab = "Poverty %", ylab = "Cancer Rate", col = 4)
abline(lm(highInc.dat$cancerRate ~ highInc.dat$povertyPercent), col = 2)
```

Now let's examine cancerToDeathRate with medIncome and PctPublicCoverage.  The results are little lesser impact compare to the previous plots.  Since the data are not giving cancer motality, this results suggest there are other factors to death rate, but medIncome and PctPublicCoverage are still impacting number of cancer incident per county.

```{r}
plot(highInc.dat$cancerToDeathRate ~ highInc.dat$medIncome, main = "Median Income to Cancer to Death Rate", xlab = "Median Income", ylab = "Cancer to Death Rate", las = 1, xlim = c(120000, 30000), col = 4)
abline(lm(highInc.dat$cancerToDeathRate ~ highInc.dat$medIncome), col = 2)

plot(highInc.dat$cancerToDeathRate ~ highInc.dat$PctPublicCoverage, main = "Public Insurance Coverage vs Cancer to Death Rate", xlab = "Public Coverage %", ylab = "Cancer to Death Rate", col = 4)
abline(lm(highInc.dat$cancerToDeathRate ~ highInc.dat$PctPublicCoverage), col = 2)
```